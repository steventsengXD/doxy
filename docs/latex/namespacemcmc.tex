\hypertarget{namespacemcmc}{}\doxysection{mcmc Module Reference}
\label{namespacemcmc}\index{mcmc@{mcmc}}
\doxysubsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \mbox{\hyperlink{namespacemcmc_a41c389f202e2fb81f35279f940ed80ee}{mcmc\+\_\+sample}} (samples, log\+\_\+rho, x\+\_\+0, n\+\_\+steps, n\+\_\+burned, thinning\+\_\+interval, s, e\+\_\+code, dof\+\_\+coefficients, density\+\_\+dimension, average\+\_\+accept, seed)
\item 
subroutine \mbox{\hyperlink{namespacemcmc_a31491c97e8ebcd42c05916b9a0b81576}{mcmc\+\_\+adapt}} (s\+\_\+out, log\+\_\+rho, x\+\_\+0, n\+\_\+steps, s\+\_\+0, e\+\_\+code, s\+\_\+max, s\+\_\+min, memory, adapt\+\_\+interval, dof\+\_\+coefficients, density\+\_\+dimension, seed)
\end{DoxyCompactItemize}


\doxysubsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespacemcmc_a31491c97e8ebcd42c05916b9a0b81576}\label{namespacemcmc_a31491c97e8ebcd42c05916b9a0b81576}} 
\index{mcmc@{mcmc}!mcmc\_adapt@{mcmc\_adapt}}
\index{mcmc\_adapt@{mcmc\_adapt}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{mcmc\_adapt()}{mcmc\_adapt()}}
{\footnotesize\ttfamily subroutine mcmc\+::mcmc\+\_\+adapt (\begin{DoxyParamCaption}\item[{real(dp), intent(out)}]{s\+\_\+out,  }\item[{}]{log\+\_\+rho,  }\item[{real(dp), dimension(density\+\_\+dimension), intent(in)}]{x\+\_\+0,  }\item[{integer, intent(in)}]{n\+\_\+steps,  }\item[{real(dp), intent(in)}]{s\+\_\+0,  }\item[{integer, intent(out)}]{e\+\_\+code,  }\item[{real(dp), intent(in)}]{s\+\_\+max,  }\item[{real(dp), intent(in)}]{s\+\_\+min,  }\item[{real(dp), intent(in)}]{memory,  }\item[{integer, intent(in)}]{adapt\+\_\+interval,  }\item[{real(dp), dimension(\+:), intent(in)}]{dof\+\_\+coefficients,  }\item[{integer, intent(in)}]{density\+\_\+dimension,  }\item[{integer, dimension(\+:), intent(in), optional}]{seed }\end{DoxyParamCaption})}



Definition at line 194 of file M\+C\+M\+C.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{194         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{195 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{intent(out)} :: s\_out}
\DoxyCodeLine{196         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: n\_steps, adapt\_interval, density\_dimension}
\DoxyCodeLine{197         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{optional} :: seed \textcolor{comment}{!the random seed, must have size>1}}
\DoxyCodeLine{198 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: dof\_coefficients}
\DoxyCodeLine{199 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{intent(in)} :: s\_0 \textcolor{comment}{!intitial guess at step size}}
\DoxyCodeLine{200 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{intent(in)} :: s\_max, s\_min \textcolor{comment}{!bounds for search space in s}}
\DoxyCodeLine{201 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{intent(in)} :: memory \textcolor{comment}{!average memory of exponetial kernal}}
\DoxyCodeLine{202 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{dimension(density\_dimension)}, \textcolor{keywordtype}{intent(in)} :: x\_0}
\DoxyCodeLine{203         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: e\_code}
\DoxyCodeLine{204 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{dimension(density\_dimension)} :: x,x\_prop}
\DoxyCodeLine{205 \textcolor{keywordtype}{        real}(dp) :: a,a\_unnorm,norm\_cnst,a\_ave,rand\_sample,log\_rho\_x,log\_rho\_x\_prop,s, factor, a\_ave\_}
\DoxyCodeLine{206 \textcolor{keywordtype}{        real}(dp) :: a\_min, a\_max \textcolor{comment}{!keep in close range about 0.235}}
\DoxyCodeLine{207         \textcolor{keywordtype}{integer} :: loop\_index, adapt\_count}
\DoxyCodeLine{208 }
\DoxyCodeLine{209         \textcolor{keyword}{interface}}
\DoxyCodeLine{210             \textcolor{keyword}{function }log\_rho(x, dof\_coefficients) \textcolor{keyword}{result}(out)}
\DoxyCodeLine{211                 \textcolor{comment}{!log target dist}}
\DoxyCodeLine{212                 \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceshared__constants}{shared\_constants}}}
\DoxyCodeLine{213 \textcolor{keywordtype}{                real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: x}
\DoxyCodeLine{214 \textcolor{keywordtype}{                real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: dof\_coefficients}
\DoxyCodeLine{215 \textcolor{keywordtype}{                real}(dp) :: out}
\DoxyCodeLine{216             \textcolor{keyword}{end function }log\_rho}
\DoxyCodeLine{217         \textcolor{keyword}{end interface}}
\DoxyCodeLine{218 }
\DoxyCodeLine{219         a\_min = 0.234\_dp}
\DoxyCodeLine{220         a\_max = 0.236\_dp}
\DoxyCodeLine{221         x = x\_0}
\DoxyCodeLine{222         a\_unnorm = 0.0\_dp}
\DoxyCodeLine{223         log\_rho\_x = log\_rho(x\_0,dof\_coefficients)}
\DoxyCodeLine{224         s=s\_0}
\DoxyCodeLine{225         norm\_cnst=1.0\_dp}
\DoxyCodeLine{226         a\_ave\_=1.0\_dp}
\DoxyCodeLine{227         factor=sqrt(2.0\_dp)}
\DoxyCodeLine{228 }
\DoxyCodeLine{229         \textcolor{comment}{!uses current random state if none is given}}
\DoxyCodeLine{230         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(seed)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{231             \textcolor{keyword}{call }random\_seed(put=seed)}
\DoxyCodeLine{232 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{233         }
\DoxyCodeLine{234         \textcolor{keywordflow}{do} loop\_index=1,n\_steps}
\DoxyCodeLine{235             x\_prop = mcmc\_propose(x,s,density\_dimension)}
\DoxyCodeLine{236             \textcolor{keyword}{call }mcmc\_accept(a, x, x\_prop, log\_rho, s, log\_rho\_x, log\_rho\_x\_prop,dof\_coefficients)}
\DoxyCodeLine{237             a = exp(a)}
\DoxyCodeLine{238             \textcolor{keyword}{call }random\_number(rand\_sample)}
\DoxyCodeLine{239             \textcolor{keywordflow}{if} (a>rand\_sample) \textcolor{keywordflow}{then}}
\DoxyCodeLine{240                 x = x\_prop}
\DoxyCodeLine{241                 log\_rho\_x = log\_rho\_x\_prop \textcolor{comment}{!using datalog\_rho\_x\_prop from last loop, saves calls to rho}}
\DoxyCodeLine{242                 \textcolor{comment}{!computing average acceptance rate, will want to have way of outputing at some point}}
\DoxyCodeLine{243                 a\_unnorm = 1.0\_dp + exp(-\/1.0\_dp/memory)*a\_unnorm}
\DoxyCodeLine{244                 a\_ave\_= (1.0\_dp+(loop\_index-\/1)*a\_ave\_)/loop\_index}
\DoxyCodeLine{245             \textcolor{keywordflow}{else}}
\DoxyCodeLine{246                 a\_unnorm = exp(-\/1.0\_dp/memory)*a\_unnorm}
\DoxyCodeLine{247                 a\_ave\_= ((loop\_index-\/1)*a\_ave\_)/loop\_index}
\DoxyCodeLine{248 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{249             norm\_cnst = 1.0\_dp + exp(-\/1.0\_dp/memory)*norm\_cnst}
\DoxyCodeLine{250 }
\DoxyCodeLine{251             adapt\_count = adapt\_count+1}
\DoxyCodeLine{252             \textcolor{keywordflow}{if} (adapt\_count .ge. adapt\_interval) \textcolor{keywordflow}{then}}
\DoxyCodeLine{253                 \textcolor{keywordflow}{if} (a\_ave\_.le.0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{254                     \textcolor{keywordflow}{if} (a\_ave\_<0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{255                         e\_code=e\_code+2**1}
\DoxyCodeLine{256                         print*, \textcolor{stringliteral}{'ERROR: Acceptance rate negative at:'}, loop\_index}
\DoxyCodeLine{257                         \textcolor{keywordflow}{EXIT}}
\DoxyCodeLine{258 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{259                     print*, \textcolor{stringliteral}{'WARNING: Acceptance rate 0 at:'}, loop\_index}
\DoxyCodeLine{260 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{261                 adapt\_count=0}
\DoxyCodeLine{262                 a\_ave = a\_unnorm/norm\_cnst}
\DoxyCodeLine{263                 \textcolor{keywordflow}{if} (a\_ave<a\_min) \textcolor{keywordflow}{then}}
\DoxyCodeLine{264                     s=s/factor}
\DoxyCodeLine{265                     \textcolor{keywordflow}{if} (s<s\_min) \textcolor{keywordflow}{then}}
\DoxyCodeLine{266                         s=s\_min}
\DoxyCodeLine{267 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{268                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (a\_ave>a\_max) \textcolor{keywordflow}{then}}
\DoxyCodeLine{269                     s=s*factor}
\DoxyCodeLine{270                     \textcolor{keywordflow}{if} (s>s\_max) \textcolor{keywordflow}{then} }
\DoxyCodeLine{271                         s=s\_max}
\DoxyCodeLine{272 \textcolor{keywordflow}{                    end if} }
\DoxyCodeLine{273 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{274 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{275 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{276 }
\DoxyCodeLine{277         s\_out=s}
\DoxyCodeLine{278         \textcolor{comment}{!e\_code 0 => no error}}
\DoxyCodeLine{279         e\_code=0}
\DoxyCodeLine{280 }

\end{DoxyCode}


Referenced by main\+\_\+driver().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{namespacemcmc_a31491c97e8ebcd42c05916b9a0b81576_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacemcmc_a41c389f202e2fb81f35279f940ed80ee}\label{namespacemcmc_a41c389f202e2fb81f35279f940ed80ee}} 
\index{mcmc@{mcmc}!mcmc\_sample@{mcmc\_sample}}
\index{mcmc\_sample@{mcmc\_sample}!mcmc@{mcmc}}
\doxysubsubsection{\texorpdfstring{mcmc\_sample()}{mcmc\_sample()}}
{\footnotesize\ttfamily subroutine mcmc\+::mcmc\+\_\+sample (\begin{DoxyParamCaption}\item[{real(dp), dimension((n\+\_\+steps-\/n\+\_\+burned)/thinning\+\_\+interval+1,density\+\_\+dimension), intent(out)}]{samples,  }\item[{}]{log\+\_\+rho,  }\item[{real(dp), dimension(density\+\_\+dimension), intent(in)}]{x\+\_\+0,  }\item[{integer, intent(in)}]{n\+\_\+steps,  }\item[{integer, intent(in)}]{n\+\_\+burned,  }\item[{integer, intent(in)}]{thinning\+\_\+interval,  }\item[{real(dp), intent(in)}]{s,  }\item[{integer, intent(out)}]{e\+\_\+code,  }\item[{real(dp), dimension(\+:), intent(in)}]{dof\+\_\+coefficients,  }\item[{integer, intent(in)}]{density\+\_\+dimension,  }\item[{real(dp), intent(out), optional}]{average\+\_\+accept,  }\item[{integer, dimension(\+:), intent(in), optional}]{seed }\end{DoxyParamCaption})}



Definition at line 103 of file M\+C\+M\+C.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{103         \textcolor{keywordtype}{implicit none}}
\DoxyCodeLine{104         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: density\_dimension}
\DoxyCodeLine{105         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: n\_steps}
\DoxyCodeLine{106         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: n\_burned}
\DoxyCodeLine{107         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: thinning\_interval}
\DoxyCodeLine{108         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)}, \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{optional} :: seed \textcolor{comment}{!the random seed, must have size>1}}
\DoxyCodeLine{109 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: dof\_coefficients}
\DoxyCodeLine{110 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{intent(in)} :: s}
\DoxyCodeLine{111 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{dimension(density\_dimension)}, \textcolor{keywordtype}{intent(in)} :: x\_0}
\DoxyCodeLine{112         \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(out)} :: e\_code}
\DoxyCodeLine{113 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{intent(out)}, \textcolor{keywordtype}{optional} :: average\_accept}
\DoxyCodeLine{114 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{dimension((n\_steps-\/n\_burned)/thinning\_interval+1,density\_dimension)}, \textcolor{keywordtype}{intent(out)} :: samples}
\DoxyCodeLine{115 \textcolor{keywordtype}{        real}(dp), \textcolor{keywordtype}{dimension(density\_dimension)} :: x,x\_prop}
\DoxyCodeLine{116 \textcolor{keywordtype}{        real}(dp) :: a,a\_ave,rand\_sample,log\_rho\_x,log\_rho\_x\_prop}
\DoxyCodeLine{117         \textcolor{keywordtype}{integer} :: loop\_index,out\_array\_index,thinning\_counter}
\DoxyCodeLine{118 }
\DoxyCodeLine{119         \textcolor{keyword}{interface}}
\DoxyCodeLine{120             \textcolor{keyword}{function }log\_rho(x, dof) \textcolor{keyword}{result}(out)}
\DoxyCodeLine{121                 \textcolor{comment}{!log target dist}}
\DoxyCodeLine{122                 \textcolor{keywordtype}{use }\mbox{\hyperlink{namespaceshared__constants}{shared\_constants}}}
\DoxyCodeLine{123 \textcolor{keywordtype}{                real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: x}
\DoxyCodeLine{124 \textcolor{keywordtype}{                real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{intent(in)} :: dof}
\DoxyCodeLine{125 \textcolor{keywordtype}{                real}(dp) :: out}
\DoxyCodeLine{126             \textcolor{keyword}{end function }log\_rho}
\DoxyCodeLine{127         \textcolor{keyword}{end interface}}
\DoxyCodeLine{128 }
\DoxyCodeLine{129         \textcolor{comment}{!e\_code 0 => no error}}
\DoxyCodeLine{130         e\_code=0}
\DoxyCodeLine{131 }
\DoxyCodeLine{132         x = x\_0}
\DoxyCodeLine{133         out\_array\_index = 0}
\DoxyCodeLine{134         thinning\_counter = 0}
\DoxyCodeLine{135         samples(1,:) = x\_0}
\DoxyCodeLine{136         a\_ave = 0.0\_dp}
\DoxyCodeLine{137         log\_rho\_x = log\_rho(x\_0,dof\_coefficients)}
\DoxyCodeLine{138 }
\DoxyCodeLine{139         \textcolor{comment}{!uses current random state if none is given}}
\DoxyCodeLine{140         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(seed)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{141             \textcolor{keyword}{call }random\_seed(put=seed)}
\DoxyCodeLine{142 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{143         }
\DoxyCodeLine{144         \textcolor{keywordflow}{do} loop\_index=1,n\_steps}
\DoxyCodeLine{145             x\_prop = mcmc\_propose(x,s,density\_dimension)}
\DoxyCodeLine{146             \textcolor{keyword}{call }mcmc\_accept(a, x, x\_prop, log\_rho, s,log\_rho\_x,log\_rho\_x\_prop, dof\_coefficients)}
\DoxyCodeLine{147             a = exp(a)}
\DoxyCodeLine{148             \textcolor{keyword}{call }random\_number(rand\_sample)}
\DoxyCodeLine{149             \textcolor{keywordflow}{if} (a>rand\_sample) \textcolor{keywordflow}{then}}
\DoxyCodeLine{150                 x = x\_prop}
\DoxyCodeLine{151                 log\_rho\_x = log\_rho\_x\_prop \textcolor{comment}{!using datalog\_rho\_x\_prop from last loop, saves calls to rho}}
\DoxyCodeLine{152                 \textcolor{comment}{!computing average acceptance rate, will want to have way of outputing at some point}}
\DoxyCodeLine{153                 a\_ave = (1.0\_dp/loop\_index)*(a\_ave*(loop\_index-\/1.0\_dp)+1.0\_dp)}
\DoxyCodeLine{154             \textcolor{keywordflow}{else}}
\DoxyCodeLine{155                 a\_ave = (1.0\_dp/loop\_index)*(a\_ave*(loop\_index-\/1))}
\DoxyCodeLine{156 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{157             \textcolor{keywordflow}{if} (loop\_index.ge.n\_burned) \textcolor{keywordflow}{then}}
\DoxyCodeLine{158                 thinning\_counter = thinning\_counter+1}
\DoxyCodeLine{159 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{160             \textcolor{keywordflow}{if} (thinning\_counter .ge. thinning\_interval) \textcolor{keywordflow}{then}}
\DoxyCodeLine{161                 out\_array\_index = out\_array\_index+1}
\DoxyCodeLine{162                 \textcolor{keywordflow}{if} (out\_array\_index>(n\_steps-\/n\_burned)/thinning\_interval) \textcolor{keywordflow}{then}}
\DoxyCodeLine{163                     e\_code = e\_code+2**2}
\DoxyCodeLine{164                     print*, \textcolor{stringliteral}{'ERROR: Output larger than output array'}, loop\_index}
\DoxyCodeLine{165                     \textcolor{keywordflow}{exit}}
\DoxyCodeLine{166 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{167                 \textcolor{keywordflow}{if} (a.ne.a) \textcolor{keywordflow}{then}}
\DoxyCodeLine{168                     e\_code=e\_code+3**1}
\DoxyCodeLine{169                     print*, \textcolor{stringliteral}{'ERROR: NAN acceptance at:'}, loop\_index}
\DoxyCodeLine{170                     \textcolor{keywordflow}{EXIT}}
\DoxyCodeLine{171 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{172                 \textcolor{keywordflow}{if} (a\_ave.le.0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{173                     \textcolor{keywordflow}{if} (a\_ave<0) \textcolor{keywordflow}{then}}
\DoxyCodeLine{174                         e\_code=e\_code+2**1}
\DoxyCodeLine{175                         print*, \textcolor{stringliteral}{'ERROR: Acceptance rate negative at:'}, loop\_index}
\DoxyCodeLine{176                         \textcolor{keywordflow}{EXIT}}
\DoxyCodeLine{177 \textcolor{keywordflow}{                    end if}}
\DoxyCodeLine{178                     print*, \textcolor{stringliteral}{'WARNING: Acceptance rate 0 at:'}, loop\_index}
\DoxyCodeLine{179 \textcolor{keywordflow}{                end if}}
\DoxyCodeLine{180                 samples(out\_array\_index,:) = x}
\DoxyCodeLine{181                 thinning\_counter=0}
\DoxyCodeLine{182 \textcolor{keywordflow}{            end if}}
\DoxyCodeLine{183 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{184 }
\DoxyCodeLine{185 }
\DoxyCodeLine{186         \textcolor{keywordflow}{if} (\textcolor{keyword}{present}(average\_accept)) \textcolor{keywordflow}{then}}
\DoxyCodeLine{187             average\_accept = a\_ave}
\DoxyCodeLine{188 \textcolor{keywordflow}{        end if}}
\DoxyCodeLine{189 }

\end{DoxyCode}


Referenced by main\+\_\+driver().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=315pt]{namespacemcmc_a41c389f202e2fb81f35279f940ed80ee_icgraph}
\end{center}
\end{figure}

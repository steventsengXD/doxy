\hypertarget{namespaceparam__search}{}\doxysection{param\+\_\+search Module Reference}
\label{namespaceparam__search}\index{param\_search@{param\_search}}


functions/subroutines associated with building/initialisation the parameter searchspace and finding the best paramters from a given M\+C\+MC run.  


\doxysubsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \mbox{\hyperlink{namespaceparam__search_a58cbd0f2cfb54aba223bfba6c19a8a46}{random\+\_\+search\+\_\+grid}} (trials, param\+\_\+bounds, n\+\_\+trials, seed\+\_\+in)
\begin{DoxyCompactList}\small\item\em random\+\_\+search\+\_\+grid returns MxN grid of test points for M free parameters and N trials distributed \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceparam__search_aff5115008e830ffa95e4143c6908a389}{latin\+\_\+hypercube}} (trials, param\+\_\+bounds, n\+\_\+trials, seed\+\_\+in)
\begin{DoxyCompactList}\small\item\em latin\+\_\+hypercube returns MxN grid of test points for M free parameters and N trials on a latin hypercube for given bounds. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceparam__search_a675279a4de8b9d57fcf6ded067479a45}{find\+\_\+best\+\_\+params}} (trial\+\_\+energies, trials)
\begin{DoxyCompactList}\small\item\em find\+\_\+best\+\_\+params returns the 1D array that contain the current best set of parameters found from a M\+C\+MC run. \end{DoxyCompactList}\item 
subroutine \mbox{\hyperlink{namespaceparam__search_a04262aed0a917d0a5e07a7213aba7cf0}{param\+\_\+wall\+\_\+check}} (param\+\_\+bounds)
\begin{DoxyCompactList}\small\item\em param\+\_\+wall\+\_\+check evaluates if the best parameter set is close to the parameter bounds used to generate the test points. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
real(dp), dimension(\+:), allocatable, protected \mbox{\hyperlink{namespaceparam__search_aa3dd5eff65c268d29ead64f36434e0d8}{best\+\_\+params}}
\item 
integer, dimension(1), protected \mbox{\hyperlink{namespaceparam__search_a709050fff27b65db5c3707ae115003e2}{best\+\_\+trial}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
functions/subroutines associated with building/initialisation the parameter searchspace and finding the best paramters from a given M\+C\+MC run. 

\doxysubsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespaceparam__search_a675279a4de8b9d57fcf6ded067479a45}\label{namespaceparam__search_a675279a4de8b9d57fcf6ded067479a45}} 
\index{param\_search@{param\_search}!find\_best\_params@{find\_best\_params}}
\index{find\_best\_params@{find\_best\_params}!param\_search@{param\_search}}
\doxysubsubsection{\texorpdfstring{find\_best\_params()}{find\_best\_params()}}
{\footnotesize\ttfamily subroutine param\+\_\+search\+::find\+\_\+best\+\_\+params (\begin{DoxyParamCaption}\item[{real(dp), dimension(\+:), intent(in), allocatable}]{trial\+\_\+energies,  }\item[{real(dp), dimension(\+:, \+:), intent(in), allocatable}]{trials }\end{DoxyParamCaption})}



find\+\_\+best\+\_\+params returns the 1D array that contain the current best set of parameters found from a M\+C\+MC run. 

the output is stored in the global variable best\+\_\+params. 
\begin{DoxyParams}{Parameters}
{\em trial\+\_\+energies} & is a 1D array of the energies found for each parameter set. \\
\hline
{\em trials} & is a 2D array containing the parameter set for each trial used in M\+C\+MC. \\
\hline
\end{DoxyParams}


Definition at line 107 of file param\+\_\+search.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{107 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:, :)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{intent(in)} :: trials}
\DoxyCodeLine{108 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{intent(in)} :: trial\_energies}
\DoxyCodeLine{109     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(1)} :: arr\_shape}
\DoxyCodeLine{110     arr\_shape = shape(trials(1,:))}
\DoxyCodeLine{111     \textcolor{keyword}{allocate}(best\_params(arr\_shape(1)))}
\DoxyCodeLine{112     best\_trial = minloc(trial\_energies) \textcolor{comment}{!index corresponding to the most negative, "best", energy.}}
\DoxyCodeLine{113     best\_params = trials(best\_trial(1),:)}

\end{DoxyCode}


References best\+\_\+params, and best\+\_\+trial.



Referenced by main\+\_\+driver().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=301pt]{namespaceparam__search_a675279a4de8b9d57fcf6ded067479a45_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceparam__search_aff5115008e830ffa95e4143c6908a389}\label{namespaceparam__search_aff5115008e830ffa95e4143c6908a389}} 
\index{param\_search@{param\_search}!latin\_hypercube@{latin\_hypercube}}
\index{latin\_hypercube@{latin\_hypercube}!param\_search@{param\_search}}
\doxysubsubsection{\texorpdfstring{latin\_hypercube()}{latin\_hypercube()}}
{\footnotesize\ttfamily subroutine param\+\_\+search\+::latin\+\_\+hypercube (\begin{DoxyParamCaption}\item[{real(dp), dimension(\+:, \+:), intent(inout)}]{trials,  }\item[{real(dp), dimension(\+:,\+:), intent(in), allocatable}]{param\+\_\+bounds,  }\item[{integer, intent(in)}]{n\+\_\+trials,  }\item[{integer, intent(in)}]{seed\+\_\+in }\end{DoxyParamCaption})}



latin\+\_\+hypercube returns MxN grid of test points for M free parameters and N trials on a latin hypercube for given bounds. 


\begin{DoxyParams}{Parameters}
{\em trials} & is a 2D array containing the parameter set for each trial used in M\+C\+MC. \\
\hline
{\em param\+\_\+bounds} & is a 2D array containing the upper and lower bounds for each parameter in the wavefunciton. \\
\hline
{\em n\+\_\+trials} & is the number of trials to be tested in M\+C\+MC. This defines the binning of the Latin hypercube. \\
\hline
{\em seed\+\_\+in} & is an integer that defines the seed being used to generate the latin Latin hypercube. \\
\hline
\end{DoxyParams}


Definition at line 55 of file param\+\_\+search.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{55 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} ,\textcolor{keywordtype}{intent(in)} :: param\_bounds \textcolor{comment}{!length of this will be the "N"}}
\DoxyCodeLine{56 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:, :)},\textcolor{keywordtype}{intent(inout)} :: trials \textcolor{comment}{! (x,y) x is each trial, y is each param}}
\DoxyCodeLine{57     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: n\_trials, seed\_in \textcolor{comment}{!n\_trials is the "M" and is specified as an input, seed\_in is an integer used to set the seed.}}
\DoxyCodeLine{58 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:)},\textcolor{keywordtype}{allocatable} ::  zero\_to\_one}
\DoxyCodeLine{59 \textcolor{keywordtype}{    real}(dp) :: rand\_num, temp\_val}
\DoxyCodeLine{60     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(2)} :: arr\_shape}
\DoxyCodeLine{61     \textcolor{keywordtype}{integer} :: i,j, k, h, n}
\DoxyCodeLine{62     \textcolor{keywordtype}{integer},\textcolor{keywordtype}{allocatable} :: seed(:)}
\DoxyCodeLine{63     \textcolor{comment}{!setting a certain seed is done as shown below.}}
\DoxyCodeLine{64     \textcolor{keyword}{call }random\_seed(size=n)}
\DoxyCodeLine{65     \textcolor{keyword}{allocate}(seed(n))}
\DoxyCodeLine{66     seed = seed\_in    \textcolor{comment}{!set seed value to that read in from input.}}
\DoxyCodeLine{67     \textcolor{keyword}{call }random\_seed(put=seed) \textcolor{comment}{!actually set the random seed for repeatability}}
\DoxyCodeLine{68     }
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \textcolor{comment}{! arr\_shape(1) contains the number of variables, param\_bounds(x,y) where x is for each param and y for limits.}}
\DoxyCodeLine{71     arr\_shape = shape(param\_bounds)}
\DoxyCodeLine{72    }
\DoxyCodeLine{73     \textcolor{keyword}{allocate}(zero\_to\_one(n\_trials))}
\DoxyCodeLine{74     \textcolor{keywordflow}{do} i = 1,n\_trials}
\DoxyCodeLine{75       zero\_to\_one(i) = (real(i, \mbox{\hyperlink{namespaceshared__constants_a0dd7b5fd793b0a608ee9409cd05314db}{dp}})-\/1.0\_dp)/(n\_trials-\/1.0\_dp) \textcolor{comment}{!extra bit needed to make sure we are binning right in the param search space!}}
\DoxyCodeLine{76 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{77     }
\DoxyCodeLine{78     \textcolor{comment}{! initialize latin cube in order.}}
\DoxyCodeLine{79     \textcolor{keywordflow}{do} i = 1,arr\_shape(1)}
\DoxyCodeLine{80       trials(:, i) = zero\_to\_one*(param\_bounds(i,1) -\/ param\_bounds(i,2)) + param\_bounds(i,2)}
\DoxyCodeLine{81 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \textcolor{comment}{!scramble the array for each param.}}
\DoxyCodeLine{84     \textcolor{keywordflow}{do} h = 1, 2 \textcolor{comment}{!sufficient scrambling.}}
\DoxyCodeLine{85       \textcolor{keywordflow}{do} i = 1,arr\_shape(1) \textcolor{comment}{!loop for each parameter.}}
\DoxyCodeLine{86         \textcolor{keywordflow}{do} j = 1, n\_trials \textcolor{comment}{!scramble over this loop}}
\DoxyCodeLine{87           \textcolor{keyword}{call }random\_number(rand\_num)}
\DoxyCodeLine{88           k = 1 + floor((n\_trials+1-\/1)*rand\_num) \textcolor{comment}{!this is how we are randomly selecting an index to swap.}}
\DoxyCodeLine{89           temp\_val=trials(k,i) \textcolor{comment}{!store temp value to swap}}
\DoxyCodeLine{90           trials(k,i) = trials(j,i) \textcolor{comment}{!swap points in the grid}}
\DoxyCodeLine{91           trials(j,i) = temp\_val \textcolor{comment}{!swap back the temp value. simple as.}}
\DoxyCodeLine{92 \textcolor{keywordflow}{        end do}}
\DoxyCodeLine{93 \textcolor{keywordflow}{      end do}}
\DoxyCodeLine{94 \textcolor{keywordflow}{    end do} }
\DoxyCodeLine{95 }
\DoxyCodeLine{96     \textcolor{keyword}{deallocate}(zero\_to\_one,seed)}

\end{DoxyCode}


Referenced by main\+\_\+driver().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{namespaceparam__search_aff5115008e830ffa95e4143c6908a389_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceparam__search_a04262aed0a917d0a5e07a7213aba7cf0}\label{namespaceparam__search_a04262aed0a917d0a5e07a7213aba7cf0}} 
\index{param\_search@{param\_search}!param\_wall\_check@{param\_wall\_check}}
\index{param\_wall\_check@{param\_wall\_check}!param\_search@{param\_search}}
\doxysubsubsection{\texorpdfstring{param\_wall\_check()}{param\_wall\_check()}}
{\footnotesize\ttfamily subroutine param\+\_\+search\+::param\+\_\+wall\+\_\+check (\begin{DoxyParamCaption}\item[{real(dp), dimension(\+:,\+:), intent(in), allocatable}]{param\+\_\+bounds }\end{DoxyParamCaption})}



param\+\_\+wall\+\_\+check evaluates if the best parameter set is close to the parameter bounds used to generate the test points. 

The tolerence is set at 5\%. 
\begin{DoxyParams}{Parameters}
{\em param\+\_\+bounds} & is a 2D array containing the upper and lower bounds for each parameter in the wavefunciton. \\
\hline
\end{DoxyParams}


Definition at line 120 of file param\+\_\+search.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{120 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} ,\textcolor{keywordtype}{intent(in)} :: param\_bounds}
\DoxyCodeLine{121 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{parameter} :: tol = 0.05\_dp \textcolor{comment}{!percentage tol as determined by the min and max bounds.}}
\DoxyCodeLine{122 \textcolor{keywordtype}{    real}(dp) :: bound\_gap }
\DoxyCodeLine{123     \textcolor{keywordtype}{integer} :: i  }
\DoxyCodeLine{124       }
\DoxyCodeLine{125     \textcolor{keywordflow}{do} i = 1, \textcolor{keyword}{size}(best\_params)}
\DoxyCodeLine{126       bound\_gap = abs(param\_bounds(i,1) -\/ param\_bounds(i,2))}
\DoxyCodeLine{127       \textcolor{keywordflow}{if} ( abs(best\_params(i) -\/ param\_bounds(i,1))/bound\_gap < tol \&}
\DoxyCodeLine{128       .or. abs(best\_params(i) -\/ param\_bounds(i,2))/bound\_gap < tol ) \textcolor{keywordflow}{then}}
\DoxyCodeLine{129         print*, \textcolor{stringliteral}{"parameter "}, i,  \textcolor{stringliteral}{" is close to wall"}}
\DoxyCodeLine{130         \textcolor{comment}{!for later: might want to instead store i in and array of potential problem parameters.}}
\DoxyCodeLine{131         \textcolor{comment}{!As oppsed to just printing out the problem. }}
\DoxyCodeLine{132 \textcolor{keywordflow}{      end if}}
\DoxyCodeLine{133 \textcolor{keywordflow}{    end do} }

\end{DoxyCode}


References best\+\_\+params.



Referenced by main\+\_\+driver().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=314pt]{namespaceparam__search_a04262aed0a917d0a5e07a7213aba7cf0_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespaceparam__search_a58cbd0f2cfb54aba223bfba6c19a8a46}\label{namespaceparam__search_a58cbd0f2cfb54aba223bfba6c19a8a46}} 
\index{param\_search@{param\_search}!random\_search\_grid@{random\_search\_grid}}
\index{random\_search\_grid@{random\_search\_grid}!param\_search@{param\_search}}
\doxysubsubsection{\texorpdfstring{random\_search\_grid()}{random\_search\_grid()}}
{\footnotesize\ttfamily subroutine param\+\_\+search\+::random\+\_\+search\+\_\+grid (\begin{DoxyParamCaption}\item[{real(dp), dimension(\+:, \+:), intent(inout)}]{trials,  }\item[{real(dp), dimension(\+:,\+:), intent(in), allocatable}]{param\+\_\+bounds,  }\item[{integer, intent(in)}]{n\+\_\+trials,  }\item[{integer, intent(in)}]{seed\+\_\+in }\end{DoxyParamCaption})}



random\+\_\+search\+\_\+grid returns MxN grid of test points for M free parameters and N trials distributed 


\begin{DoxyParams}{Parameters}
{\em trials} & is a 2D array containing the parameter set for each trial used in M\+C\+MC. \\
\hline
{\em param\+\_\+bounds} & is a 2D array containing the upper and lower bounds for each parameter in the wavefunciton. \\
\hline
{\em n\+\_\+trials} & is the number of trials to be tested in M\+C\+MC. This defines the binning of the Latin hypercube. \\
\hline
{\em seed\+\_\+in} & is an integer that defines the seed being used to generate the latin Latin hypercube. \\
\hline
\end{DoxyParams}


Definition at line 19 of file param\+\_\+search.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{19 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:,:)}, \textcolor{keywordtype}{allocatable} ,\textcolor{keywordtype}{intent(in)} :: param\_bounds \textcolor{comment}{!length of this will be the "N" }}
\DoxyCodeLine{20 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:, :)},\textcolor{keywordtype}{intent(inout)} :: trials \textcolor{comment}{! (x,y) x is each trial, y is each param}}
\DoxyCodeLine{21     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{intent(in)} :: n\_trials, seed\_in\textcolor{comment}{!this is the "M"}}
\DoxyCodeLine{22 \textcolor{keywordtype}{    real}(dp), \textcolor{keywordtype}{dimension(:)},\textcolor{keywordtype}{allocatable} :: rand\_num }
\DoxyCodeLine{23     \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(2)} :: arr\_shape}
\DoxyCodeLine{24     \textcolor{keywordtype}{integer} :: i, n}
\DoxyCodeLine{25     \textcolor{keywordtype}{integer},\textcolor{keywordtype}{allocatable} :: seed(:)}
\DoxyCodeLine{26     \textcolor{comment}{!initialising a certain seed is done as shown below.}}
\DoxyCodeLine{27     \textcolor{keyword}{call }random\_seed(size=n)}
\DoxyCodeLine{28     \textcolor{keyword}{allocate}(seed(n))}
\DoxyCodeLine{29     seed = seed\_in   \textcolor{comment}{!set seed to that read in from input.}}
\DoxyCodeLine{30     \textcolor{keyword}{call }random\_seed(put=seed)}
\DoxyCodeLine{31     }
\DoxyCodeLine{32 }
\DoxyCodeLine{33     \textcolor{comment}{! arr\_shape(1) contains the number of variables, param\_bounds(x,y) where x is for each param and y for limits.}}
\DoxyCodeLine{34     arr\_shape = shape(param\_bounds)}
\DoxyCodeLine{35     }
\DoxyCodeLine{36     \textcolor{keyword}{allocate}(rand\_num(n\_trials))}
\DoxyCodeLine{37     }
\DoxyCodeLine{38     \textcolor{keywordflow}{do} i = 1,arr\_shape(1)}
\DoxyCodeLine{39     \textcolor{keyword}{call }random\_number(rand\_num) }
\DoxyCodeLine{40     trials(:, i) = rand\_num*(param\_bounds(i,1) -\/ param\_bounds(i,2)) + param\_bounds(i,2)}
\DoxyCodeLine{41 \textcolor{keywordflow}{    end do}}
\DoxyCodeLine{42 }

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespaceparam__search_aa3dd5eff65c268d29ead64f36434e0d8}\label{namespaceparam__search_aa3dd5eff65c268d29ead64f36434e0d8}} 
\index{param\_search@{param\_search}!best\_params@{best\_params}}
\index{best\_params@{best\_params}!param\_search@{param\_search}}
\doxysubsubsection{\texorpdfstring{best\_params}{best\_params}}
{\footnotesize\ttfamily real(dp), dimension(\+:), allocatable, protected param\+\_\+search\+::best\+\_\+params}



Definition at line 10 of file param\+\_\+search.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{10 \textcolor{keywordtype}{  real}(dp), \textcolor{keywordtype}{dimension(:)}, \textcolor{keywordtype}{allocatable}, \textcolor{keywordtype}{protected} :: best\_params}

\end{DoxyCode}


Referenced by find\+\_\+best\+\_\+params(), main\+\_\+driver(), and param\+\_\+wall\+\_\+check().

\mbox{\Hypertarget{namespaceparam__search_a709050fff27b65db5c3707ae115003e2}\label{namespaceparam__search_a709050fff27b65db5c3707ae115003e2}} 
\index{param\_search@{param\_search}!best\_trial@{best\_trial}}
\index{best\_trial@{best\_trial}!param\_search@{param\_search}}
\doxysubsubsection{\texorpdfstring{best\_trial}{best\_trial}}
{\footnotesize\ttfamily integer, dimension(1), protected param\+\_\+search\+::best\+\_\+trial}



Definition at line 11 of file param\+\_\+search.\+f90.


\begin{DoxyCode}{0}
\DoxyCodeLine{11   \textcolor{keywordtype}{integer}, \textcolor{keywordtype}{dimension(1)}, \textcolor{keywordtype}{protected} :: best\_trial}

\end{DoxyCode}


Referenced by find\+\_\+best\+\_\+params(), and main\+\_\+driver().

